===============================
ğŸ§™â€â™‚ï¸ MISKATONIC QUIZ - Guide Complet
===============================

=== ğŸ“– DESCRIPTION DU PROJET ===

API de quiz universitaire avec architecture modulaire FastAPI + MongoDB + SQLite.
InspirÃ© de la Miskatonic University (Lovecraft) avec interface mÃ©diÃ©vale.

Structure refactorisÃ©e (Oct 2025) :
- main.py : 474 â†’ 25 lignes (-95%)
- Architecture modulaire professionnelle
- SÃ©paration claire des responsabilitÃ©s

=== ğŸ—ï¸ ARCHITECTURE ===

ğŸ“ Structure du projet :
```
Miskatonic/
â”œâ”€â”€ app/                          # ğŸš€ API Backend
â”‚   â”œâ”€â”€ main.py                   # Point d'entrÃ©e (25 lignes)
â”‚   â”œâ”€â”€ config.py                 # Configuration FastAPI/CORS
â”‚   â”œâ”€â”€ models.py                 # ModÃ¨les Pydantic
â”‚   â”œâ”€â”€ utils.py                  # Fonctions utilitaires
â”‚   â”œâ”€â”€ database.py               # SQLite (utilisateurs)
â”‚   â”œâ”€â”€ questions.py              # Logique MongoDB (questions)
â”‚   â””â”€â”€ routes/                   # ğŸ›£ï¸ Routes par domaine
â”‚       â”œâ”€â”€ auth_routes.py        # POST /login, /register
â”‚       â”œâ”€â”€ questions_routes.py   # GET/POST/DELETE /questions
â”‚       â”œâ”€â”€ quiz_routes.py        # /quiz/* (sessions)
â”‚       â””â”€â”€ utilities_routes.py   # /themes, /tests, /answer
â”œâ”€â”€ data/                         # ğŸ’¾ Bases de donnÃ©es
â”‚   â”œâ”€â”€ users.db                  # SQLite (auto-crÃ©Ã©)
â”‚   â”œâ”€â”€ questions.csv             # Source CSV
â”‚   â””â”€â”€ mongodb/                  # DonnÃ©es MongoDB (Docker)
â”œâ”€â”€ frontend/                     # ğŸ¨ Interface HTML/CSS
â”‚   â”œâ”€â”€ index.html                # Page d'accueil
â”‚   â”œâ”€â”€ questions.html            # Gestion questions
â”‚   â”œâ”€â”€ quiz.html                 # Interface quiz
â”‚   â””â”€â”€ style.css                 # ThÃ¨me mÃ©diÃ©val
â”œâ”€â”€ etl.py                        # ğŸ”„ Import CSV â†’ MongoDB
â”œâ”€â”€ requirements.txt              # ğŸ“¦ DÃ©pendances Python
â””â”€â”€ README.md                     # ğŸ“š Documentation
```

=== ğŸ› ï¸ STACK TECHNIQUE ===

Backend :
- FastAPI (API REST)
- Uvicorn (serveur ASGI)
- MongoDB (questions & quiz)
- SQLite (utilisateurs)
- Pydantic (validation)

Frontend :
- HTML5 + CSS3
- Bootstrap + thÃ¨me custom
- JavaScript vanilla

DevOps :
- Docker (MongoDB)
- Git (versioning)

=== âš™ï¸ INSTALLATION ===

# 1. Cloner le repo
git clone https://github.com/TheBretonDuke/Miskatonic.git
cd Miskatonic

# 2. Environnement Python
python -m venv .venvquiz
source .venvquiz/bin/activate        # macOS/Linux
# .venvquiz\Scripts\Activate.ps1    # Windows

# 3. DÃ©pendances
pip install -r requirements.txt

# 4. MongoDB (Docker)
docker run -d \
  --name mongodb_quiz \
  -p 27017:27017 \
  -v ~/data/mongodb:/data/db \
  mongo:7

# 5. Import des questions
python etl.py

=== ğŸš€ LANCEMENT ===

# DÃ©marrer MongoDB (si arrÃªtÃ©)
docker start mongodb_quiz

# Activer l'environnement
source .venvquiz/bin/activate

# Lancer l'API (hot-reload)
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# URLs importantes :
# ğŸŒ API : http://127.0.0.1:8000
# ğŸ“– Docs : http://127.0.0.1:8000/docs
# ğŸ§ª Test : http://127.0.0.1:8000/questions?limit=3

=== ğŸ”Œ ENDPOINTS API ===

ğŸ” Authentification :
POST /register    # CrÃ©er compte
POST /login       # Connexion

ğŸ“ Questions :
GET /questions                     # Liste questions
GET /questions?admin=true&username=prof1  # Mode admin
POST /questions                    # Ajouter question (prof+)
DELETE /questions                  # Supprimer question (prof+)

ğŸ¯ Quiz :
POST /quiz/create                 # CrÃ©er session (prof+)
GET /quiz/{quiz_id}              # RÃ©cupÃ©rer quiz
DELETE /quiz/{quiz_id}           # Supprimer quiz
GET /quiz                        # Lister quiz (prof+)

ğŸ› ï¸ Utilitaires :
GET /themes                      # Liste thÃ¨mes
GET /tests                       # Liste tests
GET /themes_by_test/{test}       # ThÃ¨mes par test
GET /tests_by_theme/{theme}      # Tests par thÃ¨me
POST /answer                     # VÃ©rifier rÃ©ponse

=== ğŸ‘¥ UTILISATEURS & RÃ”LES ===

ğŸ§‘â€ğŸ“ etudiant : Passer des quiz uniquement
ğŸ‘¨â€ğŸ« prof     : CrÃ©er/gÃ©rer questions + quiz
ğŸ›¡ï¸ admin    : AccÃ¨s complet systÃ¨me

Stockage : data/users.db (SQLite, auto-crÃ©Ã©)

=== ğŸ’¾ BASES DE DONNÃ‰ES ===

MongoDB (Questions) :
- URI : mongodb://localhost:27017
- Base : miskatonic_quiz
- Collection : questions
- Format : {question, theme, test, choix[], correct[]}

SQLite (Utilisateurs) :
- Fichier : data/users.db
- Table : users (username, password_hash, role)
- CrÃ©ation automatique via init_db()

=== ğŸ¨ FRONTEND ===

Interface thÃ©matique Miskatonic :
- frontend/index.html â†’ Connexion/Inscription
- frontend/questions.html â†’ Gestion questions (prof)
- frontend/quiz.html â†’ Interface quiz
- ThÃ¨me CSS mÃ©diÃ©val avec animations

=== ğŸ› ï¸ DÃ‰VELOPPEMENT ===

Architecture modulaire :
- ModÃ¨les : app/models.py
- Configuration : app/config.py
- Routes par domaine : app/routes/
- Logique mÃ©tier : app/database.py, app/questions.py
- Point d'entrÃ©e simple : app/main.py (25 lignes)

Hot-reload automatique avec --reload

=== ğŸš¨ DÃ‰PANNAGE ===

MongoDB pas dÃ©marrÃ© :
docker ps                        # VÃ©rifier conteneurs
docker start mongodb_quiz        # RedÃ©marrer si besoin

Aucune question :
python etl.py                    # RÃ©importer CSV

Port 8000 occupÃ© :
lsof -i :8000                    # Voir processus
kill -9 <PID>                    # Tuer processus

Erreur imports Python :
source .venvquiz/bin/activate    # RÃ©activer venv
pip install -r requirements.txt  # RÃ©installer dÃ©pendances

Base SQLite corrompue :
rm data/users.db                 # Supprimer
# RedÃ©marrer l'API â†’ recrÃ©ation auto

=== ğŸ“ COMMANDES UTILES ===

# Git
git status
git add .
git commit -m "Description"
git push origin main

# Docker MongoDB
docker ps                        # Conteneurs actifs
docker logs mongodb_quiz         # Logs MongoDB
docker exec -it mongodb_quiz mongosh  # Shell MongoDB

# Python
python etl.py                    # Import questions
pip freeze > requirements.txt    # Sauver dÃ©pendances
python -c "import app.main"      # Test imports

# Tests API (curl)
curl -X GET "http://127.0.0.1:8000/questions?limit=2"
curl -X POST "http://127.0.0.1:8000/register" \
  -H "Content-Type: application/json" \
  -d '{"username":"test","password":"123","role":"etudiant"}'

=== ğŸ¯ PROCHAINES Ã‰TAPES ===

AmÃ©liorations possibles :
- Tests unitaires (pytest)
- Authentification JWT
- Rate limiting
- Logging structurÃ©
- DÃ©ploiement Docker Compose
- CI/CD GitHub Actions
- Base de donnÃ©es cloud (MongoDB Atlas)

=== ğŸ“ SUPPORT ===

Auteurs :
- Simon Brouard (@TheBretonDuke)
- Lucie Jouan (@luciej0507)

Repo : https://github.com/TheBretonDuke/Miskatonic
License : MIT