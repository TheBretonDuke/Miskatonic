<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Miskatonic Quiz - Questions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Google Fonts + style global -->
  <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <!-- Barre de navigation -->
  <nav class="navbar shadow-sm mb-4">
    <div class="container d-flex justify-content-between">
      <span class="brand">Miskatonic Quiz</span>
      <div>
        <span id="welcome-user" class="me-3 small-muted"></span>
        <button id="btn-logout" class="btn btn-danger btn-sm">DÃ©connexion</button>
      </div>
    </div>
  </nav>

  <!-- Contenu principal -->
  <main class="container">
    <div class="row">
      <div class="col-md-8 mx-auto">
        <!-- Carte Questions -->
        <div class="card">
          <h2 class="mb-3">Questions disponibles</h2>
          <div id="questions-list" class="list-group"></div>
          <div class="d-grid mt-3">
            <button id="btn-start-quiz" class="btn btn-primary">Lancer le quiz</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- JS -->
  <script>
    const API_BASE = "http://127.0.0.1:8000";

    // VÃ©rifier si lâ€™utilisateur est connectÃ©
    const user = localStorage.getItem("misk_user");
    const role = localStorage.getItem("misk_role");
    if (!user || !role) {
      alert("Vous devez vous connecter.");
      window.location.href = "index.html";
    } else {
      document.getElementById("welcome-user").innerText = `ConnectÃ© : ${user} [${role}]`;
    }

    // DÃ©connexion
    document.getElementById("btn-logout").addEventListener("click", () => {
      localStorage.removeItem("misk_user");
      localStorage.removeItem("misk_role");
      window.location.href = "index.html";
    });

    // Charger et afficher les questions
    async function loadQuestions(limit = 10) {
      try {
        const res = await fetch(`${API_BASE}/questions?limit=${limit}`);
        if (!res.ok) throw new Error("Erreur API");
        const data = await res.json();

        const list = document.getElementById("questions-list");
        list.innerHTML = "";
        data.forEach((q) => {
          const item = document.createElement("div");
          item.className = "list-group-item";
          item.innerHTML = `
            <h6>${q.question}</h6>
            <p class="small-muted">ThÃ¨me : ${q.theme} | Niveau : ${q.niveau}</p>
            <ul class="list-group">
              ${q.choix.map(c => `<li class="list-group-item">ðŸ«§ ${c}</li>`).join("")}
            </ul>
          `;
          list.appendChild(item);
        });
      } catch (err) {
        console.error(err);
        document.getElementById("questions-list").innerHTML =
          `<div class="alert alert-danger">Impossible de charger les questions.</div>`;
      }
    }

    // Bouton : dÃ©marrer quiz
    document.getElementById("btn-start-quiz").addEventListener("click", () => {
      window.location.href = "quiz.html";
    });

    // Charger au dÃ©marrage
    loadQuestions();
  </script>
</body>
</html>
